<apex:page lightningStylesheets="true">
    <apex:slds />
    <div class='slds-scope'>

        <div class='slds-m-around_small'>
            <label>Enter publish Message</label>
            <input type='text' class='slds-input' id='messageField' />
        </div>
        <div class='slds-p-top_small slds-p-bottom_small'>
            <button class='slds-button slds-button_neutral' onclick='publishHandler()'>Publish</button>
            <button class='slds-button slds-button_neutral' onclick='subscribeHandler()'> Subscribe</button>
            <button class='slds-button slds-button_neutral' onclick='unsubscribeHandler()'>Unsubscribe</button>
        </div>

        <p>Message Received</p>
        <div id='receivedMessage'>

        </div>

    </div>
    <script>
        let SampleLMC = "{!$MessageChannel.SampleMessageChannel__c}"
        let subscriptiontoMC
        function publishHandler() {
            let message = {
                lmsData: {
                    value: document.getElementById('messageField').value
                }
            }
            sforce.one.publish(SampleLMC, message)
        }
        function subscribeHandler() {
            alert('subscribe handler');
            subscriptiontoMC = sforce.one.subscribe(SampleLMC, msgHandler, { scope: 'APPLICATION' });
        }
        function msgHandler(message) {

            document.getElementById('receivedMessage').innerHTML =
                message && message.lmsData.value ? message.lmsData.value : 'No Message Receieved';
        }
        function unsubscribeHandler() {
            if (subscriptiontoMC) {
                sforce.one.unsubscribe(subscriptiontoMC)
                subscriptiontoMC = null;
            }
        }

    </script>


</apex:page>